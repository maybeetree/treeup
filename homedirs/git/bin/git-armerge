#!/bin/sh

# Annex remote merge
# TODO other branches too not just main!


if ( realpath "$(which realpath)" | grep busybox )
then
	if ! command -v "coreutils"
	then
		echo "Need coreutils!"
		exit 1
	fi
	alias realpath='coreutils --coreutils-prog=realpath'
fi

if [ -z "$1" ]
then
	echo "usage: $0 <remote>"
	exit 9
fi

#set -e
message="git-rdas $(date)"
ssh "$1" "cd '$(realpath . --relative-to "$HOME")' || exit 1 ; git checkout -b main; git merge synced/main && git annex sync"
git annex sync "$1"

